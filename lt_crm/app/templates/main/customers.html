{% extends "base.html" %}

{% block title %}Klientai - LT CRM{% endblock %}

{% block styles %}
<style>
    [x-cloak] { display: none !important; }
    
    /* Enhanced visual hierarchy */
    .page-header {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
    }
    
    .stats-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
    }
    
    .stats-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    /* Improved table styling */
    .customers-table {
        background: white;
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .customers-table thead th {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        font-weight: 600;
        color: #374151;
        padding: 1rem 0.75rem;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .customers-table tbody tr {
        transition: all 0.15s ease;
    }
    
    .customers-table tbody tr:hover {
        background-color: #f8fafc;
        transform: scale(1.005);
    }
    
    .customers-table tbody td {
        padding: 0.875rem 0.75rem;
        vertical-align: middle;
    }
    
    /* Enhanced action buttons */
    .action-btn {
        transition: all 0.15s ease;
        border-radius: 0.5rem;
    }
    
    .action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Improved search and filter section */
    .filter-section {
        background: white;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    /* Enhanced pagination */
    .pagination-wrapper {
        background: white;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        padding: 1rem;
    }
    
    /* Better responsive design */
    @media (max-width: 768px) {
        .customers-table {
            font-size: 0.875rem;
        }
        
        .customers-table thead th,
        .customers-table tbody td {
            padding: 0.5rem 0.375rem;
        }
        
        .action-btn {
            padding: 0.25rem;
        }
    }
    
    /* Accessibility improvements */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
    
    /* Focus indicators */
    .focus-visible:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
    
    /* Toast styling */
    #toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 9999;
    }
    
    #toast-container .alert {
        margin-bottom: 0.5rem;
        transition: opacity 0.3s ease-in-out;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header with improved visual hierarchy -->
<div class="page-header p-6 mb-6">
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Klient≈≥ valdymas</h1>
            <nav class="text-sm breadcrumbs" aria-label="Breadcrumb">
                <ul>
                    <li><a href="{{ url_for('main.dashboard') }}" class="text-blue-600 hover:text-blue-800">Skydelis</a></li>
                    <li><span class="text-gray-500">Klientai</span></li>
                </ul>
            </nav>
        </div>
        
        <div class="flex flex-wrap gap-3">
            <a href="{{ url_for('main.customer_new') }}" class="btn btn-primary action-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Naujas klientas
            </a>
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-outline btn-primary action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19l3 3m0 0l3-3m-3 3V10" />
                    </svg>
                    Eksportuoti
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="#">CSV formatu</a></li>
                    <li><a href="#">Excel formatu</a></li>
                    <li><a href="#">PDF ataskaita</a></li>
                </ul>
            </div>
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-outline action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" />
                    </svg>
                    Veiksmai
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="{{ url_for('main.reports') }}">Ataskaitos</a></li>
                    <li><a href="#">Masinis redagavimas</a></li>
                    <li><a href="#">Importuoti klientus</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Search & Filter Section -->
<div class="filter-section p-6 mb-6">
    <div class="flex items-center gap-3 mb-6">
        <div class="p-2 bg-blue-50 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Paie≈°ka ir filtrai</h3>
    </div>
        
    <form method="GET" action="{{ url_for('main.customers') }}" class="space-y-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
            <!-- Search Input -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Paie≈°ka</span>
                </label>
                <div class="input-group">
                    <input type="text" name="q" value="{{ request.args.get('q', '') }}" 
                           placeholder="Vardas, el. pa≈°tas, telefonas..." 
                           class="input input-bordered w-full focus:border-primary" />
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- City Filter -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Miestas</span>
                </label>
                <select name="city" class="select select-bordered w-full focus:border-primary">
                    <option value="">üèôÔ∏è Visi miestai</option>
                    <option value="Vilnius" {% if request.args.get('city') == 'Vilnius' %}selected{% endif %}>Vilnius</option>
                    <option value="Kaunas" {% if request.args.get('city') == 'Kaunas' %}selected{% endif %}>Kaunas</option>
                    <option value="Klaipƒóda" {% if request.args.get('city') == 'Klaipƒóda' %}selected{% endif %}>Klaipƒóda</option>
                    <option value="≈†iauliai" {% if request.args.get('city') == '≈†iauliai' %}selected{% endif %}>≈†iauliai</option>
                    <option value="Panevƒó≈æys" {% if request.args.get('city') == 'Panevƒó≈æys' %}selected{% endif %}>Panevƒó≈æys</option>
                </select>
            </div>
            
            <!-- Type Filter -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Tipas</span>
                </label>
                <select name="type" class="select select-bordered w-full focus:border-primary">
                    <option value="">üë• Visi tipai</option>
                    <option value="individual" {% if request.args.get('type') == 'individual' %}selected{% endif %}>üßë Fizinis asmuo</option>
                    <option value="company" {% if request.args.get('type') == 'company' %}selected{% endif %}>üè¢ ƒÆmonƒó</option>
                </select>
            </div>
            
            <!-- Action Buttons -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Veiksmai</span>
                </label>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary flex-1 shadow-md hover:shadow-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                        </svg>
                        Filtruoti
                    </button>
                    <a href="{{ url_for('main.customers') }}" class="btn btn-outline hover:btn-error transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Active Filters Display -->
        {% if request.args.get('q') or request.args.get('city') or request.args.get('type') %}
        <div class="divider"></div>
        <div class="flex flex-wrap gap-2 items-center">
            <span class="text-sm font-medium opacity-70">Aktyv≈´s filtrai:</span>
            {% if request.args.get('q') %}
            <div class="badge badge-primary gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                "{{ request.args.get('q') }}"
            </div>
            {% endif %}
            {% if request.args.get('city') %}
            <div class="badge badge-secondary gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                </svg>
                {{ request.args.get('city') }}
            </div>
            {% endif %}
            {% if request.args.get('type') %}
            <div class="badge badge-accent gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                {{ request.args.get('type') }}
            </div>
            {% endif %}
        </div>
        {% endif %}
    </form>
</div>

    <!-- Customers table -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>Vardas / ƒÆmonƒó</th>
                            <th>El. pa≈°tas</th>
                            <th>Telefonas</th>
                            <th>Miestas</th>
                            <th>U≈æsakymai</th>
                            <th class="text-right">Veiksmai</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if customers %}
                            {% for customer in customers %}
                            <tr class="hover">
                                <td>
                                    <a href="{{ url_for('main.customer_detail', id=customer.id) }}" class="font-medium hover:underline">
                                        {{ customer.name }}
                                    </a>
                                    {% if customer.company %}
                                    <div class="text-sm opacity-70">{{ customer.company }}</div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if customer.email %}
                                    <a href="mailto:{{ customer.email }}" class="link link-hover">{{ customer.email }}</a>
                                    {% else %}
                                    -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if customer.phone %}
                                    <a href="tel:{{ customer.phone }}" class="link link-hover">{{ customer.phone }}</a>
                                    {% else %}
                                    -
                                    {% endif %}
                                </td>
                                <td>{{ customer.city or '-' }}</td>
                                <td>{{ customer.orders.count() }}</td>
                                <td class="text-right">
                                    <div class="flex justify-end space-x-1">
                                        <a href="{{ url_for('main.customer_detail', id=customer.id) }}" class="btn btn-ghost btn-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                            </svg>
                                        </a>
                                        <button class="btn btn-ghost btn-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="text-center py-8">
                                    {% if request.args.get('q') %}
                                        Nerasta klient≈≥ pagal pasirinktus filtrus.
                                        <a href="{{ url_for('main.customers') }}" class="btn btn-sm btn-ghost mt-2">I≈°valyti filtrus</a>
                                    {% else %}
                                        Dar nƒóra klient≈≥. Pridƒókite naujƒÖ klientƒÖ.
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    {% if pagination and pagination.pages > 1 %}
    <div class="flex justify-center mt-6">
        <div class="btn-group">
            {% if pagination.has_prev %}
            <a href="{{ url_for('main.customers', page=pagination.prev_num, **request.args) }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            {% else %}
            <button class="btn" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            {% endif %}
            
            <button class="btn">{{ pagination.page }} / {{ pagination.pages }}</button>
            
            {% if pagination.has_next %}
            <a href="{{ url_for('main.customers', page=pagination.next_num, **request.args) }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </a>
            {% else %}
            <button class="btn" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %} 