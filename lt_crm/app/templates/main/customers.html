{% extends "base.html" %}

{% block title %}Klientai - LT CRM{% endblock %}

{% block styles %}
<style>
    [x-cloak] { display: none !important; }
    
    /* Enhanced visual hierarchy */
    .page-header {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
    }
    
    .stats-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
    }
    
    .stats-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    /* Improved table styling */
    .customers-table {
        background: white;
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .customers-table thead th {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        font-weight: 600;
        color: #374151;
        padding: 1rem 0.75rem;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .customers-table tbody tr {
        transition: all 0.15s ease;
    }
    
    .customers-table tbody tr:hover {
        background-color: #f8fafc;
        transform: scale(1.005);
    }
    
    .customers-table tbody td {
        padding: 0.875rem 0.75rem;
        vertical-align: middle;
    }
    
    /* Enhanced action buttons */
    .action-btn {
        transition: all 0.15s ease;
        border-radius: 0.5rem;
    }
    
    .action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Improved search and filter section */
    .filter-section {
        background: white;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    /* Enhanced pagination */
    .pagination-wrapper {
        background: white;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        padding: 1rem;
    }
    
    /* Better responsive design */
    @media (max-width: 768px) {
        .customers-table {
            font-size: 0.875rem;
        }
        
        .customers-table thead th,
        .customers-table tbody td {
            padding: 0.5rem 0.375rem;
        }
        
        .action-btn {
            padding: 0.25rem;
        }
    }
    
    /* Accessibility improvements */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
    
    /* Focus indicators */
    .focus-visible:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
    
    /* Toast styling */
    #toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 9999;
    }
    
    #toast-container .alert {
        margin-bottom: 0.5rem;
        transition: opacity 0.3s ease-in-out;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header with improved visual hierarchy -->
<div class="page-header p-6 mb-6">
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Klient≈≥ valdymas</h1>
            <nav class="text-sm breadcrumbs" aria-label="Breadcrumb">
                <ul>
                    <li><a href="{{ url_for('main.dashboard') }}" class="text-blue-600 hover:text-blue-800">Skydelis</a></li>
                    <li><span class="text-gray-500">Klientai</span></li>
                </ul>
            </nav>
        </div>
        
        <div class="flex flex-wrap gap-3">
            <a href="{{ url_for('main.customer_new') }}" class="btn btn-primary action-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Naujas klientas
            </a>
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-outline btn-primary action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19l3 3m0 0l3-3m-3 3V10" />
                    </svg>
                    Eksportuoti
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="#">CSV formatu</a></li>
                    <li><a href="#">Excel formatu</a></li>
                    <li><a href="#">PDF ataskaita</a></li>
                </ul>
            </div>
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-outline action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" />
                    </svg>
                    Veiksmai
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="{{ url_for('main.reports') }}">Ataskaitos</a></li>
                    <li><a href="#">Masinis redagavimas</a></li>
                    <li><a href="#">Importuoti klientus</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Search & Filter Section -->
<div class="filter-section p-6 mb-6">
    <div class="flex items-center gap-3 mb-6">
        <div class="p-2 bg-blue-50 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Paie≈°ka ir filtrai</h3>
    </div>
        
    <form method="GET" action="{{ url_for('main.customers') }}" class="space-y-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
            <!-- Search Input -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Paie≈°ka</span>
                </label>
                <div class="input-group">
                    <input type="text" name="q" value="{{ request.args.get('q', '') }}" 
                           placeholder="Vardas, el. pa≈°tas, telefonas..." 
                           class="input input-bordered w-full focus:border-primary" />
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- City Filter -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Miestas</span>
                </label>
                <select name="city" class="select select-bordered w-full focus:border-primary">
                    <option value="">üèôÔ∏è Visi miestai</option>
                    <option value="Vilnius" {% if request.args.get('city') == 'Vilnius' %}selected{% endif %}>Vilnius</option>
                    <option value="Kaunas" {% if request.args.get('city') == 'Kaunas' %}selected{% endif %}>Kaunas</option>
                    <option value="Klaipƒóda" {% if request.args.get('city') == 'Klaipƒóda' %}selected{% endif %}>Klaipƒóda</option>
                    <option value="≈†iauliai" {% if request.args.get('city') == '≈†iauliai' %}selected{% endif %}>≈†iauliai</option>
                    <option value="Panevƒó≈æys" {% if request.args.get('city') == 'Panevƒó≈æys' %}selected{% endif %}>Panevƒó≈æys</option>
                </select>
            </div>
            
            <!-- Type Filter -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Tipas</span>
                </label>
                <select name="type" class="select select-bordered w-full focus:border-primary">
                    <option value="">üë• Visi tipai</option>
                    <option value="individual" {% if request.args.get('type') == 'individual' %}selected{% endif %}>üßë Fizinis asmuo</option>
                    <option value="company" {% if request.args.get('type') == 'company' %}selected{% endif %}>üè¢ ƒÆmonƒó</option>
                </select>
            </div>
            
            <!-- Action Buttons -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text font-medium">Veiksmai</span>
                </label>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary flex-1 shadow-md hover:shadow-lg transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                        </svg>
                        Filtruoti
                    </button>
                    <a href="{{ url_for('main.customers') }}" class="btn btn-outline hover:btn-error transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Active Filters Display -->
        {% if request.args.get('q') or request.args.get('city') or request.args.get('type') %}
        <div class="divider"></div>
        <div class="flex flex-wrap gap-2 items-center">
            <span class="text-sm font-medium opacity-70">Aktyv≈´s filtrai:</span>
            {% if request.args.get('q') %}
            <div class="badge badge-primary gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                "{{ request.args.get('q') }}"
            </div>
            {% endif %}
            {% if request.args.get('city') %}
            <div class="badge badge-secondary gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                </svg>
                {{ request.args.get('city') }}
            </div>
            {% endif %}
            {% if request.args.get('type') %}
            <div class="badge badge-accent gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                {{ request.args.get('type') }}
            </div>
            {% endif %}
        </div>
        {% endif %}
    </form>
</div>

<!-- Customers Table -->
<div class="customers-table">
    <div class="card-header bg-gradient-to-r from-base-200 to-base-100 p-6 border-b border-base-300/50">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-success/10 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
                <div>
                    <h3 class="text-lg font-semibold">Klient≈≥ sƒÖra≈°as</h3>
                    <p class="text-sm opacity-70">Valdykite visus klientus vienoje vietoje</p>
                </div>
            </div>
            {% if customers %}
            <div class="stats shadow-sm">
                <div class="stat py-2 px-4">
                    <div class="stat-title text-xs">Rasta klient≈≥</div>
                    <div class="stat-value text-lg">{{ customers|length }}</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="card-body p-0">
        <div class="table-container overflow-x-auto">
            <table class="table w-full">
                <thead class="bg-base-200/50">
                    <tr>
                        <th class="font-semibold">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                Klientas
                            </div>
                        </th>
                        <th class="font-semibold">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                Kontaktai
                            </div>
                        </th>
                        <th class="font-semibold">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                </svg>
                                Vieta
                            </div>
                        </th>
                        <th class="font-semibold">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                </svg>
                                U≈æsakymai
                            </div>
                        </th>
                        <th class="font-semibold text-right">
                            <div class="flex items-center gap-2 justify-end">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                </svg>
                                Veiksmai
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% if customers %}
                        {% for customer in customers %}
                        <tr class="hover:bg-base-200/50 transition-colors duration-200 border-b border-base-300/30" data-customer-id="{{ customer.id }}">
                            <td class="py-4">
                                <div class="flex items-center gap-3">
                                    <!-- Customer Avatar -->
                                    <div class="avatar placeholder">
                                        <div class="bg-neutral-focus text-neutral-content rounded-full w-10 h-10 text-sm">
                                            {{ customer.name[:1] }}
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Info -->
                                    <div>
                                        <a href="{{ url_for('main.customer_detail', id=customer.id) }}" 
                                           class="font-semibold text-primary hover:text-primary-focus transition-colors duration-200 hover:underline">
                                            {{ customer.name }}
                                        </a>
                                        {% if customer.company %}
                                        <div class="text-sm opacity-60 flex items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                            </svg>
                                            {{ customer.company }}
                                        </div>
                                        {% else %}
                                        <div class="text-sm opacity-60 flex items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                            Fizinis asmuo
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            
                            <td class="py-4">
                                <div class="space-y-1">
                                    {% if customer.email %}
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                        </svg>
                                        <a href="mailto:{{ customer.email }}" class="link link-hover text-sm">{{ customer.email }}</a>
                                    </div>
                                    {% endif %}
                                    {% if customer.phone %}
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                        </svg>
                                        <a href="tel:{{ customer.phone }}" class="link link-hover text-sm">{{ customer.phone }}</a>
                                    </div>
                                    {% endif %}
                                    {% if not customer.email and not customer.phone %}
                                    <span class="text-base-content/50 text-sm">Nƒóra kontakt≈≥</span>
                                    {% endif %}
                                </div>
                            </td>
                            
                            <td class="py-4">
                                {% if customer.city or customer.country %}
                                <div class="flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <div>
                                        <div class="font-medium">{{ customer.city or '-' }}</div>
                                        {% if customer.country %}
                                        <div class="text-xs opacity-60">{{ customer.country }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% else %}
                                <span class="text-base-content/50">-</span>
                                {% endif %}
                            </td>
                            
                            <td class="py-4">
                                <div class="flex items-center gap-2">
                                    <div class="badge badge-primary">{{ customer.orders.count() }}</div>
                                    {% if customer.orders.count() > 0 %}
                                    <span class="text-xs opacity-60">u≈æsakym≈≥</span>
                                    {% endif %}
                                </div>
                            </td>
                            
                            <td class="py-4">
                                <div class="flex gap-1 justify-end">
                                    <!-- View Customer -->
                                    <div class="tooltip tooltip-left" data-tip="Per≈æi≈´rƒóti klientƒÖ">
                                        <a href="{{ url_for('main.customer_detail', id=customer.id) }}" 
                                           class="btn btn-sm btn-ghost hover:btn-primary transition-all">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                            </svg>
                                        </a>
                                    </div>
                                    
                                    <!-- Edit Customer -->
                                    <div class="tooltip tooltip-left" data-tip="Redaguoti klientƒÖ">
                                        <a href="#" class="btn btn-sm btn-ghost hover:btn-warning transition-all edit-btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                        </a>
                                    </div>
                                    
                                    <!-- More Actions Dropdown -->
                                    <div class="dropdown dropdown-end">
                                        <label tabindex="0" class="btn btn-sm btn-ghost hover:btn-info transition-all">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                            </svg>
                                        </label>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow-xl bg-base-100 rounded-box w-48 border border-base-300">
                                            <li>
                                                <a href="{{ url_for('main.order_new') }}?customer_id={{ customer.id }}" class="gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                                    </svg>
                                                    Naujas u≈æsakymas
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                    </svg>
                                                    Si≈≥sti el. lai≈°kƒÖ
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                    </svg>
                                                    Dubliuoti
                                                </a>
                                            </li>
                                            <div class="divider my-1"></div>
                                            <li>
                                                <button class="gap-2 text-error hover:bg-error/10 delete-customer-btn" 
                                                        data-customer-id="{{ customer.id }}" 
                                                        data-customer-name="{{ customer.name }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                    I≈°trinti
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center py-16">
                                <div class="flex flex-col items-center gap-4">
                                    {% if request.args.get('q') or request.args.get('city') or request.args.get('type') %}
                                    <!-- No Results State -->
                                    <div class="p-4 bg-warning/10 rounded-full">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-warning" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h3 class="text-lg font-semibold mb-2">Nerasta klient≈≥</h3>
                                        <p class="text-base-content/70 mb-4">Pagal pasirinktus filtrus klient≈≥ nerasta. Pabandykite pakeisti paie≈°kos kriterijus.</p>
                                        <a href="{{ url_for('main.customers') }}" class="btn btn-primary gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            I≈°valyti filtrus
                                        </a>
                                    </div>
                                    {% else %}
                                    <!-- Empty State -->
                                    <div class="p-4 bg-primary/10 rounded-full">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h3 class="text-lg font-semibold mb-2">Dar nƒóra klient≈≥</h3>
                                        <p class="text-base-content/70 mb-4">Pradƒókite nuo pirmojo kliento pridƒójimo ir plƒóskite savo klient≈≥ bazƒô.</p>
                                        <a href="{{ url_for('main.customer_new') }}" class="btn btn-primary gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                            </svg>
                                            Pridƒóti pirmƒÖ klientƒÖ
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination & Summary -->
{% if customers and customers|length > 0 %}
<div class="card bg-base-100 shadow-xl border border-base-300/50 mt-8">
    <div class="card-body">
        <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
            <!-- Results Summary -->
            <div class="flex items-center gap-3">
                <div class="p-2 bg-info/10 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm font-medium">Rodoma {{ customers|length }} klient≈≥</p>
                    {% if pagination %}
                    <p class="text-xs opacity-60">{{ pagination.page }} puslapis i≈° {{ pagination.pages }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Pagination Controls -->
            {% if pagination and pagination.pages > 1 %}
            <div class="join">
                {% if pagination.has_prev %}
                <a href="{{ url_for('main.customers', page=pagination.prev_num, **request.args) }}" 
                   class="join-item btn btn-sm hover:btn-primary transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    Ankstesnis
                </a>
                {% else %}
                <button class="join-item btn btn-sm btn-disabled">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    Ankstesnis
                </button>
                {% endif %}
                
                {% for page in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page %}
                        {% if page == pagination.page %}
                        <button class="join-item btn btn-sm btn-primary">{{ page }}</button>
                        {% else %}
                        <a href="{{ url_for('main.customers', page=page, **request.args) }}" 
                           class="join-item btn btn-sm hover:btn-primary transition-all">{{ page }}</a>
                        {% endif %}
                    {% else %}
                        <button class="join-item btn btn-sm btn-disabled">...</button>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.has_next %}
                <a href="{{ url_for('main.customers', page=pagination.next_num, **request.args) }}" 
                   class="join-item btn btn-sm hover:btn-primary transition-all">
                    Kitas
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </a>
                {% else %}
                <button class="join-item btn btn-sm btn-disabled">
                    Kitas
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Items per page -->
            <div class="flex items-center gap-2">
                <span class="text-sm opacity-70">Rodyti:</span>
                <select class="select select-sm select-bordered focus:border-primary" onchange="updatePerPage(this.value)">
                    <option value="10" {% if request.args.get('per_page') == '10' %}selected{% endif %}>10</option>
                    <option value="25" {% if request.args.get('per_page') == '25' or not request.args.get('per_page') %}selected{% endif %}>25</option>
                    <option value="50" {% if request.args.get('per_page') == '50' %}selected{% endif %}>50</option>
                    <option value="100" {% if request.args.get('per_page') == '100' %}selected{% endif %}>100</option>
                </select>
                <span class="text-sm opacity-70">per puslapƒØ</span>
            </div>
        </div>
    </div>
</div>

<script>
function updatePerPage(value) {
    const url = new URL(window.location);
    url.searchParams.set('per_page', value);
    url.searchParams.delete('page'); // Reset to first page
    window.location.href = url.toString();
}
</script>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/htmx.org@1.9.2"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Edit buttons - Link to customer edit page
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const row = this.closest('tr');
                const customerId = row.getAttribute('data-customer-id');
                window.location.href = `/customers/${customerId}/edit`;
            });
        });

        // Delete customer handlers
        document.querySelectorAll('.delete-customer-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                
                const customerId = this.getAttribute('data-customer-id');
                const customerName = this.getAttribute('data-customer-name');
                
                if (confirm(`Ar tikrai norite i≈°trinti klientƒÖ ${customerName}? ≈†io veiksmo negalima bus at≈°aukti.`)) {
                    // Show loading state
                    this.innerHTML = '<span class="loading loading-spinner loading-xs"></span>';
                    this.disabled = true;
                    
                    // Delete customer via API
                    fetch(`/customers/${customerId}/delete`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Remove the row from the table
                            this.closest('tr').remove();
                            showToast(data.message, 'success');
                        } else {
                            showToast(data.message, 'error');
                        }
                    })
                    .catch(error => {
                        showToast('Klaida trinant klientƒÖ', 'error');
                        console.error('Error deleting customer:', error);
                    })
                    .finally(() => {
                        // Reset button state
                        this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>';
                        this.disabled = false;
                    });
                }
            });
        });
        
        // Helper function to show toast notifications
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `alert ${type === 'error' ? 'alert-error' : 'alert-success'} shadow-lg mb-4 animate__animated animate__fadeIn`;
            
            toast.innerHTML = `
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>${message}</span>
                </div>
                <button class="btn btn-sm btn-circle btn-ghost" onclick="this.parentElement.remove()">‚úï</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                toast.classList.add('animate__fadeOut');
                setTimeout(() => toast.remove(), 500);
            }, 5000);
        }
    });
</script>
{% endblock %} 